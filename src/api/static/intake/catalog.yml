metadata:
  version: 1
  parameters:
    shot:
      description: shot number to load from the campaign.
      type: int
sources:
  _sql_index:
    args:
      urlpath: postgres://localhost:54321/mast_db
    description: 
    driver: parquet

  index:
    args:
      targets:
        - _sql_index
      sql_expr: SELECT * FROM {{ table }} WHERE 
    description: Source referencing other sources in catalog
    driver: duckdb_transform

  sql_index:
    args:
      targets:
        - _sql_index
      sql_expr: SELECT col FROM csv_source LIMIT 10
    description: 
    driver: duckdb_transform

  tiny:
    driver: zarr
    description: "A sample of MAST data for a 'tiny' campaign of 10 shots used for testing"
    args:
      urlpath: simplecache::s3://mast/test/shots/tiny/{{shot}}.zarr/{{group}}
      storage_options:
        s3:
          anon: true
          endpoint_url: "https://s3.echo.stfc.ac.uk"
  mini:
    driver: zarr
    description: "A sample of MAST data for a 'mini' campaign of 100 shots used for testing"
    args:
      urlpath: simplecache::s3://mast/test/shots/tiny/{{shot}}.zarr/{{group}}
      storage_options:
        s3:
          anon: true
          endpoint_url: "https://s3.echo.stfc.ac.uk"
  M9:
    driver: zarr
    description: "MAST shot data for the M9 campaign"
    args:
      urlpath: simplecache://mast/shots/M9/{{shot}}.zarr/
      consolidated: true
      storage_options:
        target_protocol: 's3'
        target_options:
          anon: true
          endpoint_url: "https://s3.echo.stfc.ac.uk"
        cache_storage: '/tmp/files'
  M8:
    driver: zarr
    description: "MAST shot data for the M8 campaign"
    args:
      urlpath: s3://mast/shots/M8/{{shot}}.zarr/{{group}}
      storage_options:
        s3:
          anon: true
          endpoint_url: "https://s3.echo.stfc.ac.uk"